import Cookies from "universal-cookie";

var URL = require("url-parse");

export const logout = () => {
  const cookies = new Cookies();
  cookies.remove("secret", { path: "/" });
  cookies.remove("userId", { path: "/" });
  window.location.href = "/";
};

export const getUserName = () => new Cookies().get("userName");
export const setUserName = userName =>
  new Cookies().set("userName", userName || "", {
    path: "/",
    expires: new Date(new Date().getTime() + 30000000000)
  });

export const getUserId = () => new Cookies().get("userId");
export const saveUserId = userId =>
  new Cookies().set("userId", userId || "", {
    path: "/",
    expires: new Date(new Date().getTime() + 30000000000)
  });

export function  getAllCookies() {

  const c = new Cookies()
  return c.getAll()

}

export function handleIncomingCookies()
{

  const c = new Cookies()

  const currentUrl = new URL(window.location.href,true);

  const { query } = currentUrl

  if(query.cookieRedirect != null)
  {

    const userName = query.userName
    const userId = query.userId
    const secretKey = query.secretKey

    c.set("userName", userName || "", {
      path: "/",
      expires: new Date(new Date().getTime() + 30000000000)
    });

    c.set("userId", userId || "", {
      path: "/",
      expires: new Date(new Date().getTime() + 30000000000)
    });

    c.set("secretKey", secretKey || "", {
      path: "/",
      expires: new Date(new Date().getTime() + 30000000000)
    });

    window.location.replace(`${currentUrl.protocol}//${currentUrl.host}${currentUrl.pathname}`)

  }


}

export function redirectWithCookies() {
  const c = new Cookies().getAll();

  const currentUrl = new URL(window.location.href);

  const targetDomain = `https://secret.cooo.me`;

  let url = null;

  if (c.userId != null) {
    url = `${targetDomain}${currentUrl.pathname}?cookieRedirect=1&userName=${c.userName}&userId=${c.userId}&secretKey=${c.secretKey}`;
  } else {
    url = `${targetDomain}${currentUrl.pathname}`;
  }

  window.location.replace(url);
  // console.log(url);
}

export const getSecretKey = () => new Cookies().get("secretKey");
export const saveSecretKey = secretKey =>
  new Cookies().set("secretKey", secretKey || "", {
    path: "/",
    expires: new Date(new Date().getTime() + 30000000000)
  });
