import React from "react";
import { getUserId, getSecretKey, getUserName } from "../cookies";
import { getRequestorId } from "../utils";
import { StartView } from "./StartView";
import { SharableView } from "./SharableView";
import { PostMessage } from "../PostMessage";
import { Timeline } from "../Timeline";

export class ViewHandler extends React.Component {
  constructor(props) {
    super(props);

    this.onUserSaved = this.onUserSaved.bind(this);

    this.state = {
      userId: getUserId(),
      secretKey: getSecretKey(),
      userName: getUserName(),
      requestorId: getRequestorId()
    };
  }

  onUserSaved() {
    this.updateState();
  }

  updateState() {
    this.setState({
      userId: getUserId(),
      secretKey: getSecretKey(),
      userName: getUserName(),
      requestorId: getRequestorId()
    });
  }

  render() {
    if (this.state.requestorId) {
      if (this.state.requestorId === this.state.userId) {
        return <ShowShareView userId={this.state.userId} />;
      } else {
        return (
          <div className="max-w-3xl mx-auto px-3 p-2 mt-3 bg-white border border-gray-600 rounded-xlg">
            <PostMessage requestorId={this.state.requestorId} />
          </div>
        );
      }
    } else {
      if (this.state.userId) {
        return <ShowShareView userId={this.state.userId} />;
      } else {
        return (
          <div className="max-w-3xl mx-auto px-3 p-2 mt-3 bg-white border border-gray-600 rounded-xlg">
            <StartView onUserSaved={this.onUserSaved} />
          </div>
        );
      }
    }
  }
}

const ShowShareView = ({ userId }) => {
  return (
    <>
      <div className="max-w-3xl mx-auto px-3 p-2 mt-3 bg-white border border-gray-600 rounded-xlg">
        <SharableView userId={userId} />
      </div>
      <div className="mt-4">
        <Timeline />
      </div>
    </>
  );
};
